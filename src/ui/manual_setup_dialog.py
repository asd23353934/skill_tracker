"""
æ‰‹å‹•è¨­å®šæŒ‡å¼•å°è©±æ¡†
ç•¶ UPnP è‡ªå‹•è¨­å®šå¤±æ•—æ™‚é¡¯ç¤º
"""

import tkinter as tk
from tkinter import messagebox, scrolledtext
from src.ui.components import Colors, Fonts, RoundedButton
from src.ui.dialogs import BaseDialog


class ManualSetupDialog(BaseDialog):
    """æ‰‹å‹•è¨­å®šæŒ‡å¼•å°è©±æ¡†"""
    
    def __init__(self, parent, external_ip, local_ip):
        """åˆå§‹åŒ–å°è©±æ¡†
        
        Args:
            parent: çˆ¶è¦–çª—
            external_ip: å¤–ç¶² IP
            local_ip: å…§ç¶² IP
        """
        self.external_ip = external_ip
        self.local_ip = local_ip
        super().__init__(parent, "æ‰‹å‹•è¨­å®šç«¯å£è½‰ç™¼", 700, 600)
        self._create_ui()
    
    def _create_ui(self):
        """å‰µå»º UI"""
        # æ¨™é¡Œ
        title_frame = tk.Frame(self.dialog, bg=Colors.BG_MEDIUM)
        title_frame.pack(fill=tk.X, pady=10)
        
        tk.Label(
            title_frame,
            text="âš ï¸ UPnP è‡ªå‹•è¨­å®šå¤±æ•—",
            bg=Colors.BG_MEDIUM,
            fg=Colors.ACCENT_YELLOW,
            font=Fonts.TITLE_SMALL
        ).pack()
        
        tk.Label(
            title_frame,
            text="è«‹æ‰‹å‹•è¨­å®šè·¯ç”±å™¨ç«¯å£è½‰ç™¼",
            bg=Colors.BG_MEDIUM,
            fg=Colors.TEXT_SECONDARY,
            font=Fonts.BODY_SMALL
        ).pack()
        
        # èªªæ˜æ–‡å­—å€åŸŸ
        text_frame = tk.Frame(self.dialog, bg=Colors.BG_MEDIUM)
        text_frame.pack(fill=tk.BOTH, expand=True, padx=20, pady=10)
        
        # ä½¿ç”¨ ScrolledText
        self.text_area = scrolledtext.ScrolledText(
            text_frame,
            wrap=tk.WORD,
            font=('Consolas', 10),
            bg=Colors.BG_DARK,
            fg=Colors.TEXT_PRIMARY,
            relief=tk.FLAT,
            padx=15,
            pady=15
        )
        self.text_area.pack(fill=tk.BOTH, expand=True)
        
        # æ’å…¥èªªæ˜æ–‡å­—
        guide_text = self._generate_guide_text()
        self.text_area.insert('1.0', guide_text)
        self.text_area.config(state=tk.DISABLED)  # åªè®€
        
        # æŒ‰éˆ•å€åŸŸ
        btn_frame = tk.Frame(self.dialog, bg=Colors.BG_MEDIUM)
        btn_frame.pack(pady=15)
        
        RoundedButton(
            btn_frame,
            "ğŸ“‹ è¤‡è£½å…§ç¶² IP",
            lambda: self._copy_to_clipboard(self.local_ip),
            Colors.ACCENT_BLUE,
            width=140,
            height=35
        ).pack(side=tk.LEFT, padx=5)
        
        RoundedButton(
            btn_frame,
            "ğŸŒ è¤‡è£½å¤–ç¶² IP",
            lambda: self._copy_to_clipboard(self.external_ip),
            Colors.ACCENT_PURPLE,
            width=140,
            height=35
        ).pack(side=tk.LEFT, padx=5)
        
        RoundedButton(
            btn_frame,
            "âœ“ æˆ‘çŸ¥é“äº†",
            self.close,
            Colors.ACCENT_GREEN,
            width=140,
            height=35
        ).pack(side=tk.LEFT, padx=5)
    
    def _generate_guide_text(self):
        """ç”ŸæˆæŒ‡å¼•æ–‡å­—"""
        return f"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘             æ‰‹å‹•è¨­å®šè·¯ç”±å™¨ç«¯å£è½‰ç™¼æŒ‡å¼•                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ç”±æ–¼ UPnP è‡ªå‹•è¨­å®šå¤±æ•—ï¼Œæ‚¨éœ€è¦æ‰‹å‹•è¨­å®šè·¯ç”±å™¨æ‰èƒ½è®“ä¸åŒç¶²è·¯
çš„ç©å®¶åŠ å…¥æ‚¨çš„æˆ¿é–“ã€‚

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€æ‚¨çš„ç¶²è·¯ä¿¡æ¯ã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¤–ç¶² IP: {self.external_ip}
å…§ç¶² IP: {self.local_ip}
ç«¯å£:    9999


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€è¨­å®šæ­¥é©Ÿã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ­¥é©Ÿ 1ï¼šç™»å…¥è·¯ç”±å™¨ç®¡ç†é é¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1. æ‰“é–‹ç€è¦½å™¨
  2. è¼¸å…¥è·¯ç”±å™¨ IPï¼ˆé€šå¸¸æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼‰:
     â€¢ http://192.168.1.1
     â€¢ http://192.168.0.1
     â€¢ http://10.0.0.1
  3. è¼¸å…¥ç®¡ç†å“¡å¸³è™Ÿå¯†ç¢¼ï¼ˆé€šå¸¸åœ¨è·¯ç”±å™¨èƒŒé¢æ¨™ç±¤ï¼‰


æ­¥é©Ÿ 2ï¼šæ‰¾åˆ°ç«¯å£è½‰ç™¼è¨­å®š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ä¸åŒå“ç‰Œè·¯ç”±å™¨åç¨±ä¸åŒï¼Œå¯èƒ½æ˜¯ï¼š
  â€¢ ã€Œç«¯å£è½‰ç™¼ã€(Port Forwarding)
  â€¢ ã€Œè™›æ“¬ä¼ºæœå™¨ã€(Virtual Server)
  â€¢ ã€ŒNAT è¨­å®šã€(NAT Settings)
  â€¢ ã€Œæ‡‰ç”¨ç¨‹å¼åŠéŠæˆ²ã€(Applications & Gaming)


æ­¥é©Ÿ 3ï¼šæ–°å¢ç«¯å£è½‰ç™¼è¦å‰‡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  è«‹æŒ‰ç…§ä»¥ä¸‹ä¿¡æ¯å¡«å¯«ï¼š

  æœå‹™åç¨±:  SkillTracker
  å¤–éƒ¨ç«¯å£:  9999
  å…§éƒ¨ IP:   {self.local_ip}  â† é»æ“ŠæŒ‰éˆ•è¤‡è£½
  å…§éƒ¨ç«¯å£:  9999
  å”å®š:      TCP
  ç‹€æ…‹:      å•Ÿç”¨


æ­¥é©Ÿ 4ï¼šé–‹æ”¾ Windows é˜²ç«ç‰†
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1. æ§åˆ¶å° â†’ ç³»çµ±åŠå®‰å…¨æ€§ â†’ Windows Defender é˜²ç«ç‰†
  2. å·¦å´é»æ“Šã€Œé€²éšè¨­å®šã€
  3. å·¦å´é»æ“Šã€Œè¼¸å…¥è¦å‰‡ã€â†’ å³å´é»æ“Šã€Œæ–°å¢è¦å‰‡ã€
  4. é¸æ“‡ã€Œé€£æ¥åŸ ã€â†’ ä¸‹ä¸€æ­¥
  5. é¸æ“‡ã€ŒTCPã€â†’ ç‰¹å®šæœ¬æ©Ÿé€£æ¥åŸ : 9999 â†’ ä¸‹ä¸€æ­¥
  6. é¸æ“‡ã€Œå…è¨±é€£ç·šã€â†’ ä¸‹ä¸€æ­¥
  7. å…¨éƒ¨å‹¾é¸ â†’ ä¸‹ä¸€æ­¥
  8. åç¨±: SkillTracker â†’ å®Œæˆ


æ­¥é©Ÿ 5ï¼šæ¸¬è©¦ç«¯å£æ˜¯å¦é–‹æ”¾
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  1. è¨ªå•: http://www.yougetsignal.com/tools/open-ports/
  2. è¼¸å…¥æ‚¨çš„å¤–ç¶² IP: {self.external_ip}
  3. è¼¸å…¥ç«¯å£: 9999
  4. é»æ“Š Check
  5. å¦‚æœé¡¯ç¤º "Open" â†’ è¨­å®šæˆåŠŸ âœ…
     å¦‚æœé¡¯ç¤º "Closed" â†’ è«‹æª¢æŸ¥ä¸Šè¿°æ­¥é©Ÿ


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€å¸¸è¦‹å•é¡Œã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Q: æ‰¾ä¸åˆ°è·¯ç”±å™¨ç®¡ç†é é¢ï¼Ÿ
A: 1. ç¢ºèªé›»è…¦å·²é€£ç·šåˆ°è·¯ç”±å™¨
   2. æ‰“é–‹å‘½ä»¤æç¤ºå­—å…ƒè¼¸å…¥: ipconfig
   3. æŸ¥çœ‹ã€Œé è¨­é–˜é“ã€çš„ IP

Q: å¿˜è¨˜è·¯ç”±å™¨å¯†ç¢¼ï¼Ÿ
A: 1. æŸ¥çœ‹è·¯ç”±å™¨èƒŒé¢æ¨™ç±¤
   2. æˆ–é‡è¨­è·¯ç”±å™¨ï¼ˆæŒ‰ä½ Reset éˆ• 10 ç§’ï¼‰

Q: è¨­å®šå¾Œä»ç„¶ç„¡æ³•é€£ç·šï¼Ÿ
A: 1. æª¢æŸ¥é˜²ç«ç‰†æ˜¯å¦å…è¨±
   2. æª¢æŸ¥é˜²æ¯’è»Ÿé«”æ˜¯å¦é˜»æ“‹
   3. ç¢ºèªå…§ç¶² IP æ²’æœ‰æ”¹è®Šï¼ˆé‡å•Ÿé›»è…¦/è·¯ç”±å™¨å¾Œå¯èƒ½æ”¹è®Šï¼‰
   4. ç¢ºèªå¤–ç¶² IP æ²’æœ‰æ”¹è®Šï¼ˆæœ‰äº›ISPæœƒå®šæœŸæ›´æ›ï¼‰


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€æ›¿ä»£æ–¹æ¡ˆã€‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å¦‚æœæ‚¨ä¸æƒ³æ‰‹å‹•è¨­å®šï¼Œå¯ä»¥ï¼š

æ–¹æ¡ˆ 1: åªåœ¨åŒä¸€ WiFi ä½¿ç”¨
   â€¢ æœ€ç°¡å–®ï¼Œç„¡éœ€è¨­å®š
   â€¢ é©åˆåŒåœ°é»çš„æœ‹å‹

æ–¹æ¡ˆ 2: ä½¿ç”¨ VPN è»Ÿé«”
   â€¢ Hamachiã€ZeroTierã€Radmin VPN
   â€¢ å®‰è£å¾Œè¦–ç‚ºåŒä¸€ç¶²è·¯

æ–¹æ¡ˆ 3: ä½¿ç”¨é ç«¯æ¡Œé¢
   â€¢ Discord è¢å¹•åˆ†äº«ã€TeamViewer
   â€¢ ç°¡å–®ä½†ç•«è³ªå·®ã€å»¶é²é«˜


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

è©³ç´°åœ–æ–‡æ•™å­¸è«‹åƒè€ƒ: NETWORK_SETUP.md

"""
    
    def _copy_to_clipboard(self, text):
        """è¤‡è£½åˆ°å‰ªè²¼ç°¿"""
        self.dialog.clipboard_clear()
        self.dialog.clipboard_append(text)
        messagebox.showinfo(
            "å·²è¤‡è£½",
            f"å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿:\n{text}",
            parent=self.dialog
        )


if __name__ == '__main__':
    # æ¸¬è©¦
    root = tk.Tk()
    root.withdraw()
    
    dialog = ManualSetupDialog(root, "123.45.67.89", "192.168.1.100")
    dialog.show()
    
    root.destroy()
