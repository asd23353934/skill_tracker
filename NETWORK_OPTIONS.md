# 🌐 網路連線方案總覽

## 📊 所有方案對比

| 方案 | 難度 | 需要設定 | 跨網路 | 成本 | 延遲 | 推薦度 |
|------|------|---------|--------|------|------|--------|
| **1. 中繼伺服器** | ⭐☆☆☆☆ | ❌ 無 | ✅ 是 | 免費 | 中 | ⭐⭐⭐⭐⭐ |
| **2. UPnP 自動** | ⭐☆☆☆☆ | ❌ 無 | ✅ 是 | 免費 | 低 | ⭐⭐⭐⭐☆ |
| **3. 手動端口轉發** | ⭐⭐⭐⭐☆ | ✅ 需要 | ✅ 是 | 免費 | 低 | ⭐⭐⭐☆☆ |
| **4. 同網路** | ⭐☆☆☆☆ | ❌ 無 | ❌ 否 | 免費 | 最低 | ⭐⭐⭐⭐⭐ |
| **5. VPN 軟體** | ⭐⭐☆☆☆ | ✅ 需要 | ✅ 是 | 免費 | 中 | ⭐⭐⭐☆☆ |

---

## 🎯 方案選擇指南

### 場景 1: 同地點（宿舍、家裡、網咖）
```
推薦: 同網路連線
原因: 最簡單、最穩定、延遲最低
步驟: 連同一個 WiFi → 創建房間 → 加入
```

### 場景 2: 不同地點 + 不會設定路由器
```
推薦: 中繼伺服器
原因: 100% 免設定、任何網路都可用
步驟: 創建房間（選擇中繼模式）→ 分享代碼
注意: 需要有人架設中繼伺服器（見下方）
```

### 場景 3: 不同地點 + 路由器支援 UPnP
```
推薦: UPnP 自動端口映射
原因: 自動化、無需手動設定
步驟: 安裝 miniupnpc → 創建房間 → 自動設定
成功率: ~70%（取決於路由器）
```

### 場景 4: 不同地點 + 願意手動設定
```
推薦: 手動端口轉發
原因: 100% 可控、延遲最低
步驟: 參考 NETWORK_SETUP.md
成功率: ~95%（需要技術知識）
```

### 場景 5: 臨時組隊 + 不想麻煩
```
推薦: VPN 軟體（Hamachi, ZeroTier）
原因: 安裝後視為同網路
步驟: 雙方安裝 VPN → 加入同一網路 → 創建房間
成功率: ~90%
```

---

## 🚀 方案 1: 中繼伺服器（最推薦）

### 優點
- ✅ **100% 免設定** - 用戶完全不需要任何操作
- ✅ **任何網路都可用** - 4G、公司網路、學校網路
- ✅ **穿透任何 NAT** - 對稱型 NAT 也沒問題
- ✅ **免費部署** - Railway.app、Render.com

### 缺點
- ⚠️ 需要架設伺服器（一次性設定）
- ⚠️ 延遲稍高（+50-100ms）
- ⚠️ 依賴伺服器穩定性

### 使用方法

**架設伺服器（一次性）：**
```bash
# 選項 1: Railway.app（推薦）
1. 註冊 https://railway.app/
2. New Project → Deploy from GitHub
3. 上傳 relay_server.py
4. 獲取網址: https://xxx.railway.app

# 選項 2: 自己的 VPS
python relay_server.py --host 0.0.0.0 --port 8888
```

**用戶使用（創建房間）：**
```
1. 點擊「創建房間」
2. 選擇「中繼伺服器模式」
3. 自動連線、自動生成代碼
4. 分享代碼給隊友
```

**用戶使用（加入房間）：**
```
1. 點擊「加入房間」  
2. 輸入房間代碼
3. 自動透過中繼伺服器連線
4. 完成！
```

詳細部署指南: [RELAY_DEPLOYMENT.md](RELAY_DEPLOYMENT.md)

---

## 🔧 方案 2: UPnP 自動端口映射

### 優點
- ✅ 自動化、無需手動設定
- ✅ P2P 直連、延遲低
- ✅ 完全免費

### 缺點
- ⚠️ 需要路由器支援 UPnP
- ⚠️ 成功率 ~70%（很多路由器關閉 UPnP）
- ⚠️ 需要安裝 miniupnpc

### 使用方法

```bash
# 安裝依賴
pip install miniupnpc

# 創建房間（程式會自動嘗試 UPnP）
點擊「創建房間」→ 等待自動設定 → 完成
```

**成功的話：**
```
✅ UPnP 自動設定成功！
   端口映射已自動配置
   跨網路連線已啟用
```

**失敗的話：**
```
⚠️ UPnP 自動設定失敗
   請選擇其他方案（中繼/手動/VPN）
```

詳細說明: [UPnP_GUIDE.md](UPnP_GUIDE.md)

---

## 📖 方案 3: 手動端口轉發

### 優點
- ✅ 100% 可控
- ✅ P2P 直連、延遲最低
- ✅ 不依賴第三方服務

### 缺點
- ❌ 需要技術知識
- ❌ 需要登入路由器
- ❌ 設定步驟較多

### 使用方法

詳細圖文教學: [NETWORK_SETUP.md](NETWORK_SETUP.md)

**簡要步驟：**
```
1. 登入路由器 (http://192.168.1.1)
2. 找到「端口轉發」設定
3. 新增規則:
   - 外部端口: 9999
   - 內部 IP: 你的電腦 IP
   - 內部端口: 9999
   - 協定: TCP
4. 開放 Windows 防火牆 9999 端口
5. 創建房間、分享代碼
```

---

## 🏠 方案 4: 同網路連線（最簡單）

### 優點
- ✅ 最簡單、無需任何設定
- ✅ 延遲最低
- ✅ 最穩定

### 缺點
- ❌ 只能同一 WiFi
- ❌ 無法跨網路

### 使用方法

```
1. 兩台電腦連同一個 WiFi
2. 點擊「創建房間」
3. 分享代碼給隊友
4. 隊友點擊「加入房間」
5. 完成！
```

---

## 🔗 方案 5: VPN 軟體

### 優點
- ✅ 安裝後視為同網路
- ✅ 不需要設定路由器
- ✅ 成功率高

### 缺點
- ⚠️ 需要雙方都安裝 VPN
- ⚠️ 免費版有限制（人數、速度）
- ⚠️ 延遲稍高

### 推薦軟體

**Hamachi（最簡單）：**
```
1. 下載: https://vpn.net/
2. 創建網路
3. 邀請隊友加入
4. 視為同網路，創建房間即可
```

**ZeroTier（更專業）：**
```
1. 下載: https://www.zerotier.com/
2. 加入同一網路 ID
3. 視為同網路
```

**Radmin VPN（完全免費）：**
```
1. 下載: https://www.radmin-vpn.com/
2. 創建網路
3. 邀請隊友
```

---

## 🎯 我應該選哪個？

### 快速決策樹

```
同地點（同 WiFi）？
├─ 是 → 方案 4: 同網路連線 ✅
└─ 否 → 繼續

願意架設/使用中繼伺服器？
├─ 是 → 方案 1: 中繼伺服器 ✅（最推薦）
└─ 否 → 繼續

路由器支援 UPnP？
├─ 不知道 → 方案 2: 試試看 UPnP（安裝 miniupnpc）
│             ├─ 成功 → ✅
│             └─ 失敗 → 繼續
└─ 不支援 → 繼續

願意手動設定路由器？
├─ 是 → 方案 3: 手動端口轉發 ✅
└─ 否 → 繼續

願意安裝 VPN 軟體？
├─ 是 → 方案 5: VPN 軟體 ✅
└─ 否 → 建議使用方案 1（中繼伺服器）
```

---

## 💡 開發者建議

### 給最終用戶的預設方案

**推薦組合：**
1. **優先嘗試 UPnP** - 自動、快速
2. **失敗則提示中繼伺服器** - 100% 免設定
3. **進階用戶可選手動設定** - 最佳性能

**實現方式：**
```python
# 創建房間時
def create_room():
    # Step 1: 嘗試 UPnP
    if try_upnp():
        return "✅ UPnP 成功，跨網路連線已啟用"
    
    # Step 2: 提示使用中繼
    show_dialog(
        "UPnP 失敗，建議使用中繼伺服器模式？\n"
        "• 優點: 100% 免設定\n"
        "• 缺點: 延遲稍高\n"
        "[使用中繼] [手動設定] [取消]"
    )
```

---

## 📊 成本和性能對比

| 方案 | 部署成本 | 運行成本 | 延遲 | 頻寬消耗 |
|------|---------|---------|------|---------|
| 中繼伺服器 | 免費~$4/月 | 免費 | 50-150ms | 中 |
| UPnP 自動 | 無 | 無 | 10-50ms | 低 |
| 手動轉發 | 無 | 無 | 10-50ms | 低 |
| 同網路 | 無 | 無 | < 10ms | 低 |
| VPN 軟體 | 無 | 無 | 20-100ms | 中 |

---

## 🆘 疑難排解

### 所有方案都失敗？

**最後手段：遠端桌面**
```
方案: Discord 螢幕分享、TeamViewer
優點: 100% 可用、無需設定
缺點: 延遲高、畫質差

適用: 臨時、緊急情況
```

---

## 📝 總結

**最佳實踐：**
1. 🏠 **同地點** → 同網路（最簡單）
2. 🌐 **不同地點** → 中繼伺服器（最可靠）
3. 🔧 **進階用戶** → UPnP 或手動轉發（最佳性能）

**給新手的建議：**
- 先試試看同網路
- 需要跨網路就用中繼伺服器
- 不要被技術細節嚇到

**給進階用戶的建議：**
- 自己架設中繼伺服器（完全控制）
- 使用 UPnP + 手動設定備用
- 考慮使用 STUN/TURN 方案

---

最後更新: 2025-01-01
